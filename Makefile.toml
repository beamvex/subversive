[env]
CARGO_MAKE_EXTEND_WORKSPACE_MAKEFILE = true
CARGO_MAKE_CARGO_VERBOSE_FLAGS = "--verbose"

[config]
default_to_workspace = false
skip_core_tasks = true

[tasks.default]
description = "Development flow - format, lint, build and test"
dependencies = ["format", "lint", "build", "test"]

[tasks.format]
description = "Format code using rustfmt"
command = "cargo"
args = ["fmt", "--all", "--", "--check"]

[tasks.format-fix]
description = "Format code using rustfmt and fix errors"
command = "cargo"
args = ["fmt", "--all"]

[tasks.lint]
description = "Lint code using clippy"
command = "cargo"
args = ["clippy", "--all-targets", "--all-features", "--", "-D", "warnings"]

[tasks.build]
description = "Build the project"
command = "cargo"
args = ["build"]

[tasks.build-release]
description = "Build the project in release mode"
command = "cargo"
args = ["build", "--release"]
dependencies = ["clean"]

[tasks.test]
description = "Run tests"
command = "cargo"
args = ["test", "--all-features", "--", "--nocapture"]

[tasks.clean]
description = "Clean build artifacts"
command = "cargo"
args = ["clean"]

[tasks.coverage]
description = "Run code coverage using tarpaulin"
install_crate = { crate_name = "cargo-tarpaulin", binary = "cargo-tarpaulin", test_arg = "-V" }
command = "cargo"
args = ["tarpaulin", "--verbose", "--all-features", "--workspace", "--timeout", "120", "--out", "Html", "--output-dir", "coverage"]

[tasks.ci]
description = "CI flow - format check, lint, build and test"
dependencies = ["format", "lint", "build-release", "test"]

[tasks.dev]
description = "Development flow with watch mode"
install_crate = { crate_name = "cargo-watch", binary = "cargo-watch", test_arg = "-V" }
command = "cargo"
args = ["watch", "-x", "fmt", "-x", "clippy", "-x", "build", "-x", "test"]
